# [期魔方]()

# 基础功能
## K线图表
#### 选择合约

方案一、在键盘直接输入对应合约代码，如rb2401,实现品种快速查找

方案二、在交易所列表下，依次翻阅对应的品种，到具体合约

![img2](../../docs/static/typora-user-images/image-20231023183113412.png)

#### 加载指标

![image-20231023182600386](../../docs/static/typora-user-images/image-20231023182600386.png)

主图指标和幅图指标分别加载

#### 加入自选

在策略列表点按下☆，则加入自选成功

![image-20231023182841583](../../docs/static/typora-user-images/image-20231023182841583.png)



## 期货实盘

### 账号登录

第一步，点期魔方客户端右下角，[登录] 按钮![image-20231023180723132](../../docs/static/typora-user-images/image-20231023180723132.png)

第二步，选择自己的期货公司，并输入自己的期货账户和密码，执行登录

![image-20231023180902740](../../docs/static/typora-user-images/image-20231023180902740.png)

第三步，出现持仓面板弹窗后，登录完成

![image-20231023181441561](../../docs/static/typora-user-images/image-20231023181441561.png)

### 支持期货公司

华安期货、国泰君安、光大期货、NZG_MOM

更多期货公司，陆续开通中

## 盯盘预警

### 预警条件设置

#### 条件单设置

#### 指标信号设置

#### 模型信号设置

### 预警推送设置

#### 本地电脑弹窗

#### 微信消息推送

#### 其他推送方式

## 量化交易

### 模块量化

### 编程量化

## 指标图表

### 导入指标

### 导出指标

### 加载指标

### 删除指标

### 编辑指标

# 特色功能

## 盘手训练

### 关于盘手训练

有人说，成功的交易策略，来源于大量的实践数据来完善?

通过大量的复盘和训练，在更短的时间内，熟知价格的波动规则，验证自己交易策略的可行性，从而节省您的时间和避免不必要的资金损失。

期魔方盘手训练系统助您更高效的挖掘最适合自己的交易策略。

<video src="D:\工作文件夹\8月16日\8月16日.mp4"></video>

### 适用人群

如果你准备入行，不熟悉期货交易规则，通过盘手训练系统可以快速感受K线跳动的魅力。

如果你需要验证自己策略的可靠性，盘手训练系统无疑是最佳的选择，不需要等待，不需要承担亏损风险，几个月甚至数年的行情，数分钟即可走完。

如果你是一位投资者教育老师，希望你的策略技巧和战法能被学员快速掌握，期魔方盘手训练系统给予最大的支持。

### 技术支持

期魔方盘手训练系统是一款应用于国内期货市场的强大复盘软件，适用于多种场景

**数据支持**

期魔方支持不低于8000根K线的高清历史数据快照，包含国内期货所有交易所数据，您在训练时，可自由选择

**周期支持**

期魔方支持1分钟、3分钟、5分钟、15分钟、30分钟、45分钟、1小时，2小时，4小时，日线及周线的K线周期，最大可能满足您的训练需求

**训练真实**

期魔方支持训练初始资金、交易手数、保证金、交易滑点、手续费损耗等数据，让您在训练过程中，交易结果更贴近实盘

**记账模式**

期魔方建立独有的交易记账模式，可实现分笔加仓减仓等操作，并每笔开平仓均单独核算统计

**指标支持**

如果您的策略是依据指标实现，期魔方在训练过程中支持加载自主或官方指标到训练K线图表

**分析报告**

训练成功如何？风险控制怎么样？期魔方可生成完整的分析报告，多维度解析您的交易结果

### 操作方法

#### **选择合约**

方式1.通过键盘精灵找到需要训练的合约

![d2b5ca33bd150711](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd150711.png)

方式2.在期魔方主界面对应的K线图表，右键鼠标-K线训练进入

![d2b5ca33bd150727](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd150727.png)

#### **设置参数**

如下图，点设置按钮，弹出对话框，设置需要的参数：

初始资金，应不低于最小保证金金额

滑点损耗（输入0则不启用此参数）

保证金比例（默认读取交易所标准保证金比例，可以不用额外设置）

K线数量，默认不超过8000根，具体需要根据合约长度计算

开始时间，默认为从今天开始往前推根K线的时间，和K线根数设置二选一

![d2b5ca33bd150752](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd150752.png)

#### **训练下单**

1.指标加载和切换，以及指标参数调整

![d2b5ca33bd150814](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd150814.png)

#### **画图工具的使用**

![d2b5ca33bd150838](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd150838.png)

3.训练模式启动和手数设置，复盘训练速度设置

![d2b5ca33bd150855](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd150855.png)

#### **分析报告**

多维度输出训练结果，让学习更直观

![d2b5ca33bd150913](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd150913.png)

期魔方官方下载地址：https://www.qmfquant.com/

#### **常见问题**

##### **1.无法下单**

主连、指数均无法实现下单；保证金不足时，也无法下单

##### **2.搜索不到需要的合约**

搜索品种时，需要注意合约代码的大小写，以及拼写是否有误

##### **3.K线数量较少**

每个合约的最长周期为12个月，结束后则会被交割，比如现在是2023年8月15日，您选择2405的合约，合约总计只有3个月的K线数量

## MT4CTP

MT4是国际上一款领先的交易软件，其具有强大的图表功能，EA自动交易功能等。

MT4CTP是期魔方研发的一款一款使用MT4来做期货交易的工具，可实现在MT4模拟下单，买卖信号时时更新到期货实盘账户中。

### 登录期货实盘账户

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps1.jpg) 

选择自己的期货公司，输入期货实盘账户、密码，并完成登录

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps2.jpg) 

### 登录MT4模拟账户

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps3.jpg) 

 

### 启动MT4CTP联动

1. 将ctp.ex4放置在MT4文件/数据文件夹/MQL4/Experts

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps4.jpg) 

2. 通信设置：MT4/工具/选项/EA交易/允许WebRequest(打钩)/添加新URL：http://127.0.0.1

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps5.jpg) 

3. 在任意K线图表加载ctp，确保是笑脸状态

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps6.jpg) 

4. 在期魔方平台登录期货账户后，绑定MT4模拟账户和期货实盘

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps7.jpg) 

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps8.jpg) 

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps9.jpg) 

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps10.jpg) 

5. 在期魔方MT4CTP端口显示：【已连接】，并且在MT4图表显示：【期魔方通道已链接】&&【期货账户已登录】，设置完成。

### 交易执行

在MT4交易合法的期货合约时，期货实盘账户同步实现交易

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps11.jpg) 

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps12.jpg) 

所有交易和报单记录日志，在期魔方MT4CTP时时显示

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps13.jpg) 

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps14.jpg) 

### 常见问题

1. 期魔方软件下载地址：https://www.qmfquant.com/#/product

2. MT4软件包及MT4模拟账号，找客服领取

3. 实盘无法登录期魔方，或无您的期货公司选项，详询客服

4. 24小时期货实盘自动登录维护，请打开期魔方24小时登录开关

![img](file:///C:\Users\64624\AppData\Local\Temp\ksohtml23136\wps15.jpg) 

5. MT4CTP窗口和MT4软件应处于同一电脑

6. MT4CTP窗口和MT4软件应7*24小时在线，请勿关闭，可最小化

7. 请在期货开盘时间设置实盘通信

8. 期货账户显示休盘中，无需处理，开盘后会自动更新为已登录

9. 期货实盘报单方式为市价报单，高频交易请谨慎使用（1s内开平仓大于1次）

10. 此系统仅为通过MT4交易国内期货的通道工具，非投资策略

# API文档

## 指标编写

### My_Language文档

#### 序列行情函数

**CLOSE, C**

```
收盘价
返回该周期收盘价
```

**VOL , V**

```
成交量
返回该周期成交量
```

**OPEN, O**

```
开盘价
返回该周期开盘价
```

**HIGH, H**

```
最高价
返回该周期最高价
```



**LOW, L**

```
最低价
返回该周期最低价
```



**AMOUNT, AMO**

```
成交额（元）
返回该周期成交额
```



**ZSTJJ**

```
均价线
返回该周期的分时图均价线,对于分时图周期指标有效.
用法: ZSTJJ
```



**VOLINSTK, OPI**

```
周期持仓量
返回该周期持仓量,对于期货和期权有意义.
用法: VOLINSTK
```



**QHJSJ, SETTLE**

```
结算价
返回该周期结算价,对于期货和期权有意义.
用法: QHJSJ
```



**ISUP**

```
判断该周期是否收阳
注： 1、ISUP等同于C>O
```



**ISEQUAL**

```
判断该周期是否平盘
注： 1、ISEQUAL等同于C=O
```



**ISDOWN**

```
判断该周期是否收阴
注： 1、ISDOWN等同于C<O
```



#### 获取指定品种行情数据

CLOSE(品种代码)/C(品种代码)

```
收盘价
```



**VOL(品种代码)/V(品种代码)**

```
成交量
```



**OPEN(品种代码)/O(品种代码)**

```
开盘价
```



**HIGH(品种代码)/H(品种代码)**

```
最高价
```



**LOW(品种代码)/L(品种代码)**

```
最低价
```



**AMOUNT(品种代码)/AMO(品种代码)**

```
成交金额
```



**VOLINSTK(品种代码)**

```
持仓量 （期货才有）
```

```javascript
  收盘价:C("000001.SZ"),NODRAW;
  开盘价:O("000001.SZ"),NODRAW;
  最高价:H("000001.SZ"),NODRAW;
  最低价:L("000001.SZ"),NODRAW;

  DRAWKLINE(最高价,开盘价,最低价,收盘价);
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/cf499907908246a6a0799ecf4b961f86.png)

#### 时间函数

**PERIOD**

```
取得周期类型.
结果从0到13,依次分别是1/5/15/30/60分钟,日/周/月,多分钟,多日/季/年,5秒线/多秒线,13以上为自定义周期
```



**DATE**

```
日期
取得该周期从1900以来的的年月日。
用法: DATE 例如函数返回1000101,表示2000年1月1日,DATE+19000000后才是真正的日期值
```



**MONTH**

```
月份
取得该周期的月份。
用法: MONTH 函数返回有效值范围为(1-12)
```



**YEAR**

```
年份
取得该周期的年份。
用法: YEAR
```



**TIME**

```
取得该周期的时分,适用于日线以下周期
用法: TIME 函数返回有效值范围为(0000-2359)
```



**TIME2**

```
取得该周期的时分秒,适用于日线以下周期.
用法:
TIME2
函数返回有效值范围为(000000-235959)
```



**WEEKOFYEAR**

```
取得该周是年内第几个周.
用法:
WEEKOFYEAR
```



**DATETODAY(date)**

```
指定日期到1990.12.19的天数.
用法: DATETODAY(date).返回date到1990.12.19的天数.有效日期为(901219-1341231)
例如: DATETODAY(901219)返回0.
```



**DAYTODATE(N)**

```
求1990.12.19后第若干天的日期.
用法:DAYTODATE(N).返回1990.12.19后第N天的日期.有效天数为(0-20000)
例如: DAYTODATE(0)返回901219.
```



**MACHINEDATE**

```
取得当前客户端机器从1900以来的的年月日,比如2016年10月1日为:01161001,MACHINEDATE+19000000后才是真正的日期值
```



**MACHINETIME**

```
取得当前客户端机器的时间,比如11:01:15时为110115
```



**MACHINEWEEK**

```
取得当前客户端机器为星期几(1,2,3,4,5,6,0)
```



**DAYSTOTODAY**

```
取得该周期的日期离今天的天数.
用法:
DAYSTOTODAY
```



**TIMETOSEC**

```
求指定时刻距0时有多长时间.
用法:
TIMETOSEC(time)
TIMETOSEC(time).返回time时刻距0时有多长时间,单位为秒.有效时间为(0-235959)
例如:
TIMETOSEC(93000)返回34200.
```



**SECTOTIME**

```
求0时后若干秒是什么时间.
用法:
SECTOTIME(N)
SECTOTIME(N).返回0时后N秒是什么时间.有效秒数为(0-86399)
例如:
SECTOTIME(34200)返回93000.
```



**FROMOPEN**

```
求该品种当前时刻已开盘有多少分钟.
用法:
FROMOPEN
FROMOPEN.返回当前时刻距开盘有多少分钟(开市期间的相对时间).
```



**TOTALFZNUM**

```
求该品种的每天的总交易分钟数.
用法:
TOTALFZNUM
TOTALFZNUM.返回当前品种的每天的总交易分钟数,单位为分钟.
```



#### 引用函数

**BARPOS**

```
返回从第一根K线开始到当前的周期数
注：
1、BARPOS返回本地已有的K线根数，从本机上存在的数据开始算起。
2、本机已有的第一根K线上返回值为1。
例1：
A:=LLV(L,BARPOS);//定义变量A为本地已有数据的最小值。
例2：
A:=IFELSE(BARPOS=1,H,0);//如果当前K线是本机已有的第一根K线,变量A返回K线的最高值，否则取0。xxxxxxxxxx BARPOS返回从第一根K线开始到当前的周期数注：1、BARPOS返回本地已有的K线根数，从本机上存在的数据开始算起。2、本机已有的第一根K线上返回值为1。例1：A:=LLV(L,BARPOS);//定义变量A为本地已有数据的最小值。例2：A:=IFELSE(BARPOS=1,H,0);//如果当前K线是本机已有的第一根K线,变量A返回K线的最高值，否则取0。1
```

**BARSCOUNT**

```
求总的周期数
用法: BARSCOUNT(X)第一个有效数据到当前的天数。
例如:BARSCOUNT(CLOSE) 对于日线数据取得上市以来总交易日数
BARSLAST 上一条件成立位置
上一次条件成立到当前的周期数。
用法: BARSLAST(X):上一次X不为0到现在的天数。
例如: BARSLAST(CLOSE/REF(CLOSE,1)>=1.1)表示上一个涨停板到当前的周期数。
```



**BARSSINCE**

```
首个条件成立位置
第一个条件成立到当前的周期数。
用法: BARSSINCE(X):第一次X不为0到现在的天数。
例如: BARSSINCE(HIGH>10)表示股价超过10元时到当前的周期数
```



**BARSSINCEN**

```
N周期内首个条件成立位置
N周期内第一个条件成立到当前的周期数。
用法: BARSSINCEN(X,N):N周期内第一次X不为0到现在的天数,N为常量。
例如: BARSSINCEN(HIGH>10,10)表示10个周期内股价超过10元时到当前的周期数
```



**COUNT**

```
统计
统计满足条件的周期数。
用法: COUNT(X,N),统计N周期中满足X条件的周期数,若N<0则从第一个有效值开始。
例如: COUNT(CLOSE>OPEN,20)表示统计20周期内收阳的周期数
```



**CURRBARSCOUNT**

```
到最后交易的周期
求到最后交易日的周期数。
用法: CURRBARSCOUNT 求到最后交易日的周期数。
```



**AMA(X,A)**

```
求自适应均线值
用法:AMA(X,A),A为自适应系数,必须小于1.
算法: Y=Y’+A*(X-Y’).初值为X
```



**DMA**

```
动态移动平均
求动态移动平均.
用法:
DMA(X,A),求X的动态移动平均.
算法:Y=A*X+(1-A)*Y’,其中Y’表示上一周期Y值,A必须大于0且小于1.A支持变量.
例如:
DMA(CLOSE,VOL/CAPITAL)表示求以换手率作平滑因子的平均价
```



**EMA**

```
指数移动平均
返回指数移动平均。
用法: EMA(X,N):X的N日指数移动平均。
算法: Y=(X*2+Y’*(N-1))/(N+1)。 EMA(X,N)相当于SMA(X,N+1,2),N支持变量
```



**EXPMA**

```
指数移动平均
返回指数移动平均。
用法: EMA(X,N):X的N日指数移动平均。
算法: Y=(X*2+Y’*(N-1))/(N+1)。 EMA(X,N)相当于SMA(X,N+1,2),N支持变量
```



**EXPMEMA**

```
指数平滑移动平均
返回指数平滑移动平均。
用法: EXPMEMA(X,N):X的N日指数平滑移动平均。 EXPMEMA同EMA(EXPMA)的差别在于他的起始值为一平滑值。
```



**TMA(X,A,B)**

```
返回移动平均
用法:TMA(X,A,B),A和B必须小于1.
算法:Y=(A*Y’+B*X),其中Y’表示上一周期Y值.初值为X
```



**FILTER**

```
过滤
过滤连续出现的信号.
用法:FILTER(X,N):X满足条件后,将其后N周期内的数据置为0,N为常量
例如:
FILTER(CLOSE>OPEN,5)查找阳线,5天内再次出现的阳线不被记录在内
```



**HV(X,N)**

```
HV(X,N)：求X在N个周期内（不包含当前k线）的最高值。注：
1、若N为0则从第一个有效值开始算起(不包含当前K线)；
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算，第一根k线返回空值；
3、N为空值时，返回空值。
4、N可以是变量。
例1：
HH:HV(H,10);//求前10根k线的最高点。
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;
ZH:VALUEWHEN(DATE<>REF(DATE,1),HV(H,N));//在分钟周期上，求昨天最高价。
例3：
HV(H,5) 和 REF(HHV(H,5),1) 的结果是一样的，用HV编写更加方便。
```



**HHV**

```
求最高值
用法: HHV(X,N),求N周期内X最高值,N=0则从第一个有效值开始。
例如: HHV(HIGH,30)表示求30日最高价。
```



**HHVBARS**

```
上一高点位置
求上一高点到当前的周期数.
用法:
HHVBARS(X,N):求N周期内X最高值到当前周期数,N=0表示从第一个有效值开始统计
例如:
HHVBARS(HIGH,0)求得历史新高到到当前的周期数
```



**HOD(X,N)**

```
求高值名次
求高值名次.
用法:
HOD(X,N):求当前X数据是N周期内的第几个高值,N=0则从第一个有效值开始.
例如:
HOD(HIGH,20)返回是20日的第几个高价
```



**LV(X,N)**

```
LV(X,N) 求X在N个周期内的最小值（不包含当前k线）。
注：
1、若N为0则从第一个有效值开始算起;
2、当N为有效值，但当前的k线数不足N根，按照实际的根数计算;
3、N为空值时，返回空值。
4、N可以是变量。用法: LLV(X,N),求N周期内X最低值,N=0则从第一个有效值开始。
例1：
LL:LV(L,10);//求前面10根k线的最低点。（不包含当前k线）
例2：
N:=BARSLAST(DATE<>REF(DATE,1))+1;//分钟周期，日内k线根数.
ZL:VALUEWHEN(DATE<>REF(DATE,1),LV(L,N));//在分钟周期上，求昨天最低价。
例3：
LV(L,5) 和 REF(LLV(L,5),1) 的结果是一样的，用LV编写更加方便。
```



**LLV**

```
求最低值
用法: LLV(X,N),求N周期内X最低值,N=0则从第一个有效值开始。
例如: LLV(LOW,0)表示求历史最低价
```



**LLVBARS**

```
上一低点位置
求上一低点到当前的周期数.
用法:
LLVBARS(X,N):求N周期内X最低值到当前周期数,N=0表示从第一个有效值开始统计
例如:
LLVBARS(HIGH,20)求得20日最低点到当前的周期数
```



**LOD(X,N)**

```
求低值名次
用法:
LOD(X,N):求当前X数据是N周期内的第几个低值,N=0则从第一个有效值开始.
例如:
LOD(LOW,20)返回是20日的第几个低价
```



**MEMA**

```
平滑移动平均
返回平滑移动平均
用法:
MEMA(X,N):X的N日平滑移动平均,如Y=(X+Y’*(N-1))/N
MEMA(X,N)相当于SMA(X,N,1)
```



**MA**

```
简单移动平均
返回简单移动平均。
用法: MA(X,N):X的N日简单移动平均。
算法: (X1+X2+X3+…+Xn)/N,N支持变量
```



**MULAR**

```
累乘
求累乘.
用法:
MULAR(X,N),统计N周期中X的乘积.N=0则从第一个有效值开始.
例如:
MULAR(C/REF(C,1),0)表示统计从上市第一天以来的复利
```



**RANGE**

```
介于某个范围之间
RANGE(A,B,C):A在B和C范围之间,B<A<C。
用法: RANGE(A,B,C)表示A大于B同时小于C时返回1,否则返回0
```



**REF**

```
日前的
引用若干周期前的数据(平滑处理)。
用法:REF(X,A),引用A周期前的X值.A可以是变量.平滑处理:当引用不到数据时进行的操作.此函数中,平滑时使用上一个周期的引用值。
例如: REF(CLOSE,BARSCOUNT©-1)表示第二根K线的收盘价
```



**REFX(X,A)**

```
引用A周期后的X值
属于未来函数,引用若干周期后的数据(平滑处理)。
用法:REFX(X,A),引用A周期后的X值.A可以是变量。
平滑处理:当引用不到数据时进行的操作.此函数中,平滑时使用上一个周期的引用值。
例如:TT:=IF(C>O,1,2); REFX(CLOSE,TT);表示阳线引用下一周期的收盘价,阴线引用日后第二周期的收盘价
```



**REFV(X,A)**

```
引用A周期前的X值
引用若干周期前的数据(未作平滑处理)。
用法: REFV(X,A),引用A周期前的X值.A可以是变量。
平滑处理:当引用不到数据时进行的操作。
例如: REFV(CLOSE,BARSCOUNT©-1)表示第二根K线的收盘价
REFXV(X,A),引用A周期后的X值
属于未来函数,引用若干周期后的数据(未作平滑处理)
用法:REFXV(X,A),引用A周期后的X值.A可以是变量
平滑处理:当引用不到数据时进行的操作。
例如: REFXV(CLOSE,1)表示下一周期的收盘价,在日线上就是明天收盘价
```



**REFDATE**

```
引用自1900年以来指定日期的数据。
用法: REFDATE(X,A),引用A日期的X值。
例如: REFDATE(CLOSE,1011208)表示2001年12月08日的收盘价
```



**REVERSE**

```
求相反数
求相反数.
用法:
REVERSE(X)返回-X.
例如:
REVERSE(CLOSE)返回-CLOSE
```



**SMA**

```
移动平均
返回移动平均。
用法: SMA(X,N,M):X的N日移动平均,M为权重,如Y=(X*M+Y’*(N-M))/N
```



**SUM**

```
求总和
用法: SUM(X,N),统计N周期中X的总和,N=0则从第一个有效值开始。
例如: SUM(VOL,0)表示统计从上市第一天以来的成交量总和
```



**SUMBARS**

```
累加到指定值的周期数
向前累加到指定值到现在的周期数.
用法:
SUMBARS(X,A):将X向前累加直到大于等于A,返回这个区间的周期数
例如:SUMBARS(VOL,CAPITAL)求完全换手到现在的周期数
```



**TFILTER**

```
信号过滤(多头)
过滤连续出现的信号。
用法: TFILTER(买入条件,卖出条件,N);过滤掉买入(卖出)信号发出后,下一个反向信号发出前的所有买入(卖出)信号。N=1表示仅对买入信号过滤;N=2表示仅对卖出信号过滤;N=0表示对买入和卖出信号都过滤,返回1,2表示买入或卖出条件成立;同一K线上只能有一个信号。
例如: ENTERLONG:TFILTER(买入,卖出,1);EXITLONG:TFILTER(买入,卖出,2)
```



**WMA**

```
加权移动平均
返回加权移动平均.
用法:
WMA(X,N):X的N日加权移动平均.算法:Yn=(1*X1+2*X2+…+n*Xn)/(1+2+…+n)
```



**BARSLASTCOUNT(X)**

```
统计连续满足条件的周期数
用法: BARSLASTCOUNT(X),统计连续满足X条件的周期数.
例如: BARSLASTCOUNT(CLOSE>OPEN)表示统计连续收阳的周期数
```



**TOPRANGE(X)**

```
当前值是近多少周期内的最大值.
用法:TOPRANGE(X):X是近多少周期内X的最大值.
例如: TOPRANGE(HIGH)表示当前最高价是近多少周期内最高价的最大值
```



**LOWRANGE(X)**

```
当前值是近多少周期内的最小值.
用法: LOWRANGE(X):X是近多少周期内X的最小值.
例如: LOWRANGE(LOW)表示当前最低价是近多少周期内最低价的最小值
```



**FINDHIGH(VAR,N,M,T)**

```
N周期前的M周期内的第T个最大值.
用法: FINDHIGH(VAR,N,M,T):VAR在N日前的M天内第T个最高价
```



**FINDLOW(VAR,N,M,T)**

```
N周期前的M周期内的第T个最小值.
用法: FINDLOW(VAR,N,M,T):VAR在N日前的M天内第T个最低价
```



**FINDLOWBARS(VAR,N,M,T)**

```
N周期前的M周期内的第T个最小值到当前周期的周期数.
用法: FINDLOWBARS(VAR,N,M,T):VAR在N日前的M天内第T个最低价到当前周期的周期数
```



**FINDHIGHBARS(VAR,N,M,T)**

```
N周期前的M周期内的第T个最大值到当前周期的周期数.
用法: FINDHIGHBARS(VAR,N,M,T):VAR在N日前的M天内第T个最高价到当前周期的周期数
```



**ZTPRICE**

```
返回涨停价
用法:
ZTPRICE(REF(CLOSE,1),0.1):按10%计算得到在昨收盘基础上的涨停价(对于复权序列K线,由于复权处理或不复权时的分红转增,根据前一天的收盘价计算结果可能与涨停价不符)
比如:
ZTPrice(REF(QHJSJ,1),0.1),得到期货的涨停价
```



**DTPRICE**

```
返回跌停价
用法:
DTPRICE(REF(CLOSE,1),0.1):按10%计算得到在昨收盘基础上的跌停价(对于复权序列K线,由于复权处理或不复权时的分红转增,根据前一天的收盘价计算结果可能与跌停价不符)
比如:
DTPrice(REF(QHJSJ,1),0.6),得到期货的跌停价(跌停比例为0.6的话)
```



**CONST**

```
CONST(A):取A最后的值为常量.
用法:
CONST(INDEXC)表示取指数现价
```



**BACKSET**

```
属于未来函数,将当前位置到若干周期前的数据设为1.
用法:
BACKSET(X,N),若X非0,则将当前位置到N周期前的数值设为1.
例如:
BACKSET(CLOSE>OPEN,2)若收阳则将该周期及前一周期数值设为1,否则为0
```



**ALIGNRIGHT(X)**

```
有效数据右对齐.
用法:
ALIGNRIGHT(X)有效数据向右移动,左边空出来的周期填充无效值
例如:TC:=IF(CURRBARSCOUNT=2 || CURRBARSCOUNT=5,DRAWNULL,C);XC:ALIGNRIGHT(TC);删除了两天的收盘价,并将剩余数据右移
```



**TRMA(X,N)：**

```
求X在N个周期的三角移动平均值
算法：三角移动平均线公式，是采用算数移动平均，并且对第一个移动平均线再一次应用算数移动平均。
TRMA(X,N) 算法如下
ma_half= MA(X,N/2)
trma=MA(ma_half,N/2)
注：
1、N包含当前k线。
2、当N为有效值，但当前的k线数不足N根，函数返回空值。
3、N为0或空值的情况下，函数返回空值。
例1：
TRMA5:TRMA(CLOSE,5);//计算5个周期内收盘价的三角移动平均。(N不能被2整除)
//TRMA(CLOSE,5)=MA(MA(CLOSE,(5+1)/2)),(5+1)/2);
例2:
TRMA10:TRMA(CLOSE,10);// 计算10个周期内收盘价的三角移动平均。(N能被2整除)
TRMA(CLOSE,10)=MA(MA(CLOSE,10/2),(10/2)+1));
```



**HARMEAN(X,N)**

```
求X在N个周期内的调和平均值
算法举例：
HARMEAN(X,5)=1/[(1/X1+1/X2+1/X3+1/X4+1/X5)/5]
注：
1、N包含当前k线。
2、调和平均值与倒数的简单平均值互为倒数。
3、当N为有效值，但当前的k线数不足N根，函数返回空值。
4、N为0或空值的情况下，函数返回空值。
5、X为0或空值的情况下，函数返回空值。
6、N可以为变量。
例：
HM5:=HARMEAN(C,5);//求5周期收盘价的调和平均值。
```



#### 字符串函数

**CODE**

```
返回品种代码.
用法:
DRAWTEXT_FIX(ISLASTBAR,0,0,0,CODE);在屏幕左上角显示品种代码
```



**CODELIKE**

```
模糊匹配品种代码
品种代码是否以参数开头。
用法: if(CODELIKE(‘600’),x,y)
```



**NAMELIKE**

```
模糊匹配品种名称
品种名称是否以参数开头.
用法: if(NAMELIKE(‘ST’),x,y)
```



**NAMEINCLUDE**

```
品种名称中是否包含参数
用法: if(NAMEINCLUDE(‘文化’),x,y);
```



**STRCAT(A,B)**

```
将两个字符串A,B(非序列化)相加成一个字符串C.
用法: STRCAT(‘多头’,‘开仓’)将两个字符串’多头’,‘开仓’相加成一个字符串’多头开仓’
```



**CON2STR(A,N)**

```
取A最后的值(非序列值)转为字符串,小数位数N.
用法: CON2STR(FINANCE(20),3)表示取营业收入,以3位小数转为字符串
```



**CON2STR(A,N)**

```
取A最后的值(非序列值)转为字符串,小数位数N。
用法:
CON2STR(FINANCE(20),3)表示取营业收入,以3位小数转为字符串
```



**VAR2STR(A,N)**

```
取A的每一个值转为字符串,小数位数N.
用法:
VAR2STR(C,3)表示取收盘价,以3位小数转为字符串
```



**STRCAT(A,B)**

```
将两个字符串A,B(非序列化)相加成一个字符串C.
用法:
STRCAT(‘多头’,‘开仓’)将两个字符串’多头’,‘开仓’相加成一个字符串’多头开仓’
STRSPACE(A)
字符串附带一空格
```



**VARCAT(A,B)**

```
将两个字符串A,B相加成一个字符串C.
用法:
DRAWTEXT(CLOSE>OPEN,LOW,VARCAT(‘多头’,VAR2STR(C,2))) 将两个字符串相加成一个字符串并按条件显示出来
```



**FINDSTR**

```
FINDSTR(A,B):在字符串A中查找字符串B,如果找到返回1,否则返回0.
用法:
FINDSTR(‘多头开仓’,‘开仓’)在字符串’多头开仓’中查找字符串’开仓’,返回1
```



**STRLEN**

```
STRLEN(S):得到字符串S(非序列值)的长度.
用法:
STRLEN(‘通达信’)表示字符串’通达信’为3
```



**STRCMP**

```
STRCMP(A,B):比较两个字符串A,B是否相等.
用法:
STRCMP(HYBLOCK,‘房地产’)将成分股行业字符串与’房地产’比较,是否相等,如果相等表示属于房地产板块
```



#### 逻辑函数

**CROSS**

```
上穿
两条线交叉。
用法: CROSS(A,B)表示当A从下方向上穿过B时返回1,否则返回0。
例如: CROSS(MA(CLOSE,5),MA(CLOSE,10))表示5日均线与10日均线交金叉
```



**CROSSDOWN(A,B)**

```
CROSSDOWN(A,B)：表示当A从上方向下穿B，成立返回1(Yes)，否则返回0(No)。
注：
1、CROSSDOWN(A,B)等同于CROSS(B,A)，CROSSDOWN(A,B)编写更利于理解。
例1：
MA5:=MA(C,5);
MA10:=MA(C,10);
CROSSDOWN(MA5,MA10),ICON(1,‘ICO5’);//MA5下穿MA10标注绿箭头 //CROSSDOWN(MA5,MA10),ICON(1,‘ICO5’); 与 CROSSDOWN(MA5,MA10)=1,ICON(1,‘ICO5’);表达同等意义
```



**CROSSUP(A,B)**

```
CROSSUP(A,B) 表当A从下方向上穿过B，成立返回1(Yes)，否则返回0(No)
注：
1、CROSSUP(A,B)等同于CROSS(A,B)，CROSSUP(A,B)编写更利于理解。
例1：
MA5:=MA(C,5);
MA10:=MA(C,10);
CROSSUP(MA5,MA10),ICON(1,‘ICO4’);//MA5上穿MA10，标注红箭头。 //CROSSUP(MA5,MA10),ICON(1,‘ICO4’); 与 CROSSUP(MA5,MA10)=1,ICON(1,‘ICO4’);表达同等意义
```



**DOWNNDAY**

```
连跌
返回是否连跌周期。
用法: DOWNNDAY(CLOSE,M) 表示连跌M个周期,M为常量
```



**EXIST**

```
存在
是否存在。
用法: EXIST(CLOSE>OPEN,10) 表示前10日内存在着阳线
```



**EVERY**

```
一直存在
用法: EVERY(CLOSE>OPEN,10) 表示前10日内一直阳线
LAST 持续存在
LAST(X,A,B):持续存在。
用法: LAST(CLOSE>OPEN,10,5) 表示从前10日到前5日内一直阳线。 若A为0,表示从第一天开始,B为0,表示到最后日止
```



**LONGCROSS**

```
持续周期后上穿
两条线维持一定周期后交叉。
用法:LONGCROSS(A,B,N)表示A在N周期内都小于B,本周期从下方向上穿过B时返回1,否则返回0
```



**NDAY**

```
连大
返回是否持续存在X>Y。
用法: NDAY(CLOSE,OPEN,3) 表示连续3日收阳线
```



**NOT**

```
取反
求逻辑非。
用法: NOT(X)返回非X,即当X=0时返回1,否则返回0。
例如: NOT(ISUP)表示平盘或收阴
```



**UPNDAY**

```
连涨
返回是否连涨周期数。
用法: UPNDAY(CLOSE,M) 表示连涨M个周期,M为常量
```



**LAST**

```
LAST(X,A,B):持续存在.
例如:
LAST(CLOSE>OPEN,10,5)
表示从前10日到前5日内一直阳线
若A为0,表示从第一天开始,B为0,表示到最后日止
```



**EXISTR**

```
EXISTR(X,A,B):是否存在(前几日到前几日间).
例如:
EXISTR(CLOSE>OPEN,10,5)
表示从前10日内到前5日内存在着阳线
若A为0,表示从第一天开始,B为0,表示到最后日止,第2,3个参数为常量
```



**ISVALID**

```
判断是否是有效数值.
```



#### 选择函数

**IF**

```
条件判断
根据条件求不同的值。
用法: IF(X,A,B)若X不为0则返回A,否则返回B。
例如: IF(CLOSE>OPEN,HIGH,LOW)表示该周期收阳则返回最高值,否则返回最低值
```



**IFF**

```
条件判断
根据条件求不同的值，
用法: IF(X,A,B)若X不为0则返回A,否则返回B。
例如: IFF(CLOSE>OPEN,HIGH,LOW)表示该周期收阳则返回最高值,否则返回最低值
```



**IFN**

```
根据条件求不同的值,同IF判断相反.
用法:
IFN(X,A,B)若X不为0则返回B,否则返回A
例如:
IFN(CLOSE>OPEN,HIGH,LOW)表示该周期收阴则返回最高值,否则返回最低值
```



**IFC**

```
根据条件执行不同的语句,可中止(根据序列的最后一个数值来判断).
用法:
IFC(X,A,B)若X不为0则执行A,否则执行B.IFC与IF函数的区别:根据X的值来选择性执行A、B表达式.
例如:
IFC(CLOSE>OPEN,HIGH,TESTSKIP(1));L;表示当日收阳则返回最高值,并执行下一句"L;",否则退出公式计算
```



**VALUEWHEN**

```
VALUEWHEN(COND,X)
当COND条件成立时,取X的当前值,否则取VALUEWHEN的上个值.
```



**TESTSKIP**

```
TESTSKIP(A):满足A则直接返回.
用法:
TESTSKIP(A)
表示如果满足条件A则该公式直接返回,不再计算接下来的表达式 注意:A为非序列数据,只取最后一个数据
```



#### 数学函数

**ABS**

```
绝对值
求绝对值,用法: ABS(X)返回X的绝对值。
例如: ABS(-34)返回34
```



**ACOS**

```
反余弦值
用法: ACOS(X)返回X的反余弦值
```



**ASIN**

```
反正弦值
用法: ASIN(X)返回X的反正弦值
```



**ATAN**

```
反正切值
用法: ATAN(X)返回X的反正切值
```



**COS**

```
余弦
用法: COS(X)返回X的余弦值
```



**EXP**

```
指数
用法: EXP(X)为e的X次幂。
例如: EXP(CLOSE)返回e的CLOSE次幂
```



**LN**

```
自然对数
求自然对数.
用法: LN(X)以e为底的对数。
例如: LN(CLOSE)求收盘价的对数
```



**LOG**

```
对数
求10为底的对数。
用法: LOG(X)取得X的对数。
例如: LOG(100)等于2
```



**MAX**

```
较大值
求最大值。
用法: MAX(A,B)返回A和B中的较大值。
例如: MAX(CLOSE-OPEN,0)表示若收盘价大于开盘价返回它们的差值,否则返回0
```



**MAX6**

```
较大值
求6个参数中的最大值.
用法: MAX6(A,B,C,D,E,F)返回较大值
```



**MIN**

```
较小值
求最小值。
用法: MIN(A,B)返回A和B中的较小值。
例如: MIN(CLOSE,OPEN)返回开盘价和收盘价中的较小值
```



**MIN6**

```
较小值
求6个参数中的最小值.
用法: MIN6(A,B,C,D,E,F)返回较小值
```



**SIN**

```
正弦
正弦值。
用法: SIN(X)返回X的正弦值
```



**SQRT**

```
开方
开平方。
用法: SQRT(X)为X的平方根。
例如: SQRT(CLOSE)收盘价的平方根
```



**TAN**

```
正切
正切值。
用法: TAN(X)返回X的正切值
```



**INTPART(A)**

```
取整
用法: INTPART(A)返回沿A绝对值减小方向最接近的整数
例如: INTPART(12.3)求得12,INTPART(-3.5)求得-3
```



**FRACPART**

```
小数部分.
用法: FRACPART(X),返回X的小数部分
```



**CEILING**

```
向上舍入.
用法: CEILING(A)返回沿A数值增大方向最接近的整数。
例如: CEILING(12.3)求得13,CEILING(-3.5)求得-3
```



**FLOOR**

```
向下舍入
用法: FLOOR(A)返回沿A数值减小方向最接近的整数。
例如: FLOOR(12.3)求得12,FLOOR(-3.5)求得-4
```



**MOD**

```
取模
用法: MOD(M,N),返回M关于N的模(M除以N的余数)。
例如: MOD(5,3)返回2
```



**BETWEEN**

```
介于
用法: BETWEEN(A,B,C)表示A处于B和C之间时返回1,B<A<C或C<A<B,否则返回0。
例如: BETWEEN(CLOSE,MA(CLOSE,10),MA(CLOSE,5))表示收盘价介于5日均线和10日均线之间
```



**ROUND**

```
四舍五入
用法: ROUND(X),返回X四舍五入到个位的数值
```



**ROUND2**

```
四舍五入
用法: ROUND2(X,N),返回X四舍五入到N位小数的数值。
由于精度问题,数据越大误差可能越大数学函数
```



**SIGN**

```
取符号.
用法:
SIGN(X),返回X的符号.当X>0,X=0,X<0分别返回1,0,-1
```



#### 统计函数

**AVEDEV**

```
平均绝对偏差
用法：AVEDEV(X,N) 返回平均绝对偏差
```



**BETA β(Beta)**

```
系数
β(Beta)系数
BETA(N) 返回当前证券N周期收益与对应大盘指数收益相比的贝塔系数
(对应指数的数据必须要先下载到本地)
```



**COVAR**

```
协方差
用法：COVAR(X,Y,N) 返回X和Y的N周期的协方差
```



**DEVSQ**

```
数据偏差平方和
用法：DEVSQ(X,N) 返回数据偏差平方和
```



**FORCAST**

```
线性回归预测值
用法：FORCAST(X,N) 返回线性回归预测值
RELATE 相关系数
用法：RELATE(X,Y,N) 返回X和Y的N周期的相关系数
```



**SLOPE**

```
线性回归斜率
用法：SLOPE(X,N) 返回线性回归斜率
```



**STD**

```
估算标准差
用法：STD(X,N) 返回估算标准差
```



**STDP**

```
总体标准差
用法：STDP(X,N) 返回总体标准差
```



**VAR**

```
估算样本方差
用法：VAR(X,N) 返回估算样本方差
```



**VARP**

```
总体样本方差
用法：VARP(X,N) 返回总体样本方差
```



#### 形态函数

**COST**

```
成本分布
成本分布情况。
用法: COST(10),表示10%获利盘的价格是多少,即有10%的持仓量在该价格以下,其余90%在该价格以上,为套牢盘。该函数仅对日线分析周期有效
```



**PEAKBARS**

```
波峰位置
属于未来函数,前M个ZIG转向波峰到当前距离。
用法: PEAKBARS(K,N,M)表示之字转向ZIG(K,N)的前M个波峰到当前的周期数,M必须大于等于1。
例如: PEAKBARS(0,5,1)表示%5开盘价ZIG转向的上一个波峰到当前的周期数
```



**SAR**

```
抛物转向
抛物转向.
用法:SAR(N,S,M)
N为计算周期,S为步长,M为极值
例如:
SAR(10,2,20)表示计算10日抛物转向,步长为2%,极限值为20%
```



**SARTURN**

```
抛物转向点.
用法:SARTURN(N,S,M)
N为计算周期,S为步长,M为极值,若发生向上转向则返回1,若发生向下转向则返回-1,否则为0
其用法与SAR函数相同
```



**TROUGH**

```
属于未来函数,前M个ZIG转向波谷值.
用法:
TROUGH(K,N,M)表示之字转向ZIG(K,N)的前M个波谷的数值,M必须大于等于1
例如:
TROUGH(2,5,2)表示%5最低价ZIG转向的前2个波谷的数值
```



**TROUGHBARS**

```
波谷位置
属于未来函数,前M个ZIG转向波谷到当前距离。
用法: TROUGHBARS(K,N,M)表示之字转向ZIG(K,N)的前M个波谷到当前的周期数,M必须大于等于1。
例如: TROUGHBARS(2,5,2)表示%5最低价ZIG转向的前2个波谷到当前的周期数
```



**WINNER**

```
获利盘比例
用法: WINNER(CLOSE),表示以当前收市价卖出的获利盘比例。
例如: 返回0.1表示10%获利盘;WINNER(10.5)表示10.5元价格的获利盘比例。该函数仅对日线分析周期有效
```



**ZIG**

```
之字转向
属于未来函数,之字转向。
用法: ZIG(K,N),当价格变化量超过N%时转向,K表示0:开盘价,1:最高价,2:最低价,3:收盘价,其余:数组信息。
例如: ZIG(3,5)表示收盘价的5%的ZIG转向
```



**COSTEX**

```
区间成本.
用法:
例如COSTEX(CLOSE,REF(CLOSE,1)),表示近两日收盘价格间筹码的成本
该函数仅对日线分析周期有效
```



**LWINNER**

```
近期获利盘比例.
用法: LWINNER(5,CLOSE),表示最近5天的那部分成本以当前收市价卖出的获利盘比例
例如:
返回0.1表示10%获利盘
```



#### 指数标的函数

**INDEXA**

```
返回大盘成交额
```



**INDEXC**

```
返回大盘收盘价
```



**INDEXH**

```
返回大盘最高价
```



**INDEXL**

```
返回大盘最低价
```



**INDEXO**

```
返回大盘开盘价
```



**INDEXV**

```
返回大盘成交量
```



#### 绘图函数

**BACKGROUND 背景设置函数**

```
用法：BACKGROUND(背景色,边框颜色, 左边间距, 右边间距, 底部间距,顶部间距) 背景设置函数，跟DRAWTEXT函数连接使用。
示例：DRAWTEXT(CLOSE>OPEN,LOW,‘大阳线’),ALIGN1,VALIGN2, BACKGROUND(RGB(22,33,44),RGB(255,250,250), 1,1,1,1);
```



**DRAWCOLORKLINE 绘制K线**

```
用法：
DRAWCOLORKLINE(Cond,Color,Empty);
满足Cond条件时，按照Color颜色绘制K线，根据Empty标志判断是空心还是实心。COLOR代表颜色，Empty非0为空心。
注：
不支持将该函数定义为变量，即不支持下面的写法：
A:DRAWCOLORKLINE(Cond,Color,Empty);
例：
```

```javascript
DRAWCOLORKLINE(C>O,COLORBLUE,0);//收盘价大于开盘价，用蓝色绘制实心K线
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/5c9e2990d48f467fbe96890a643880e6.png)

**DRAWTEXT**

```
显示文字
用法：DRAWTEXT(COND,PRICE,TEXT),当COND条件满足时,在PRICE位置书写文字TEXT。
例如: DRAWTEXT(CLOSE/OPEN>1.08,LOW,‘大阳线’)表示当日实体阳线大于8%时在最低价位置显示’大阳线’字样。
DRAWTEXT_LINE 画文字及线段
用法：DRAWTEXT_LINE(COND,PRICE, text,textcolor,fontSize,linetype,linecolor)
当COND条件满足时,在PRICE位置沿水平方向最左边显示文字text, 字体颜色textcolor， 字体大小fontSize, 绘制水平线(linetype=0不画水平线 1=实线， 2=虚线）,linecolor线段颜色。
例如DRAWTEXT_LINE(C>O,C,“文字”,RGB(255,0,0),15,1,RGB(0,0,255));
```



**DRAWTEXTABS**

```
用法：DRAWTEXTABS(X,Y,TEXT),在图形窗口(X,Y)坐标位置书写文字TEXT，坐标单位是像素,图形窗口左上角坐标为(0,0)。
例如：DRAWTEXTABS(0,0,‘注意’)表示在图形最左上角位置显示’注意’字样。
```



**DRAWTEXTREL**

```
用法：DRAWTEXTREL(X,Y,TEXT),在图形窗口(X,Y)坐标位置书写文字TEXT，坐标单位是窗口沿水平和垂直方向的1/1000，X、Y取值范围是0—999,超出范围则可能显示在图形窗口外。
例如：DRAWTEXTREL(500,500,‘注意’)表示在图形中间位置显示’注意’字样。
```



**DRAWBAND**

```
画带状线
用法：DRAWBAND(VAL1,COLOR1,VAL2,COLOR2),当VAL1>VAL2时,在VAL1和VAL2之间填充COLOR1;当VAL1<VAL2时,填充COLOR2,这里的颜色均使用RGB函数计算得到。
```

```javascript
DRAWBAND(OPEN,RGB(0,224,224),CLOSE,RGB(255,96,96))
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/304101eeb8f042fab425e309cca8e5ac.png)

**DRAWKLINE**

```
k线
DRAWKLINE(HIGH,OPEN,LOW,CLOSE)。
用法：以HIGH为最高价,OPEN为开盘价,LOW为最低,CLOSE收盘画K线。
```

```javascript
收:=C("000001.SH");
  开:=O("000001.SH");
  低:=L("000001.SH");
  高:=H("000001.SH");

  DRAWKLINE(高,开,低,收), COLORYELLOW;
  收盘价:收,NODRAW;
  1234567
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/653d5511982c4ab292c1f0d93b7dcd9f.png)

**DRAWGBK**

```
填充背景
用法：DRAWGBK(COND,COLOR1,COLOR2,渐进色方向0=竖1=横),当条件COND满足时填充背景,如果COLOR1和COLOR2有一个不为0,则以COLOR1到COLOR2的渐变色为背景。
例如：DRAWGBK(O>C,RGB(0,255,0),RGB(255,0,0),0)。
```



**DRAWGBK2**

```
填充K线背景
用法：DRAWGBK2(COND,COLOR1,COLOR2,渐进色方向0=竖1=横),当条件COND满足时填充满足条件的K线背景,如果COLOR1和COLOR2有一个不为0,则以COLOR1到COLOR2的渐变色为背景。
例如：DRAWGBK2(O>C,RGBA(0,255,0,0.5),RGBA(255,0,0,0.5),0);
```

```javascript
VOL:VOL,VOLSTICK;
  MA1:MA(VOL,M1);
  MA2:MA(VOL,M2);

  DRAWGBK2(O>C,RGBA(0,255,0,0.5),RGBA(255,0,0,0.5),0);
  12345
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/a263ca05397d4eb7823d5b943fecd613.png)

**DRAWNUMBER**

```
画数字
用法：DRAWNUMBER(COND,PRICE,NUMBER),当COND条件满足时,在PRICE位置书写数字NUMBER。
例如：DRAWNUMBER(CLOSE/OPEN>1.08,LOW,C)表示当日实体阳线大于8%时在最低价位置显示收盘价。
```



**DRAWICON**

```
图标
用法：DRAWICON(COND,PRICE,TYPE),当COND条件满足时,在PRICE位置画TYPE号图标(TYPE为1–46)。
例如：DRAWICON(CLOSE>OPEN,LOW,1)表示当收阳时在最低价位置画1号图标。
图标类型可
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/img_convert/0e2120ce303e903dab4119179260fb36.png#pic_center)

**DRAWCHANNEL**

```
绘制通道
用法：DRAWCHANNEL(condition, data, data2, borderColor, borderWidth, dotted, areaColor)
condition:条件;
data,data2:通道顶部和底部;
borderColor: 通道顶部和底部线段颜色RGB/RGBA,不填就不画 如: ‘RGB(24,30,40)’;
borderWidth: 通道顶部和底部线段宽度;
areaColor: 通道面积颜色RGB/RGBA 不填使用默认颜色 如:‘RGB(200,30,44)’ ;
dotted: 通道顶部和底部虚线设置, 不填默认 3, 如’3,4’ ， ‘0’=实线

例子1：在[7.5,8.0]区间段画一个通道
DRAWCHANNEL(1,7.5,8.0, RGB(255,94,102), 1 ,‘5,3’,RGBA(58,20,62,0.3) );
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/8e732c18e0744bc498d630e1623a69a4.png)

```
例子2：以最高价和最低价画一个通道
DRAWCHANNEL(1,HIGH,LOW, RGB(255,0,0), 1 ,‘5,5’,RGBA(58,20,0,0.5) );
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/2e3eb46094d9461abf18554b311ffc9a.png)

```
例子3：开盘>收盘的区间端以最高价和最低价画一个通道
DRAWCHANNEL(OPEN>CLOSE,HIGH,LOW, ‘RGB(255,94,102)’, 2 ,‘5,5’,‘RGBA(58,20,62,0.3)’ );
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/6ef660cdeeaa4b3ba713b735194c47d2.png)

```
DRAWRECTREL 相对位置上画矩形
用法: DRAWRECTREL(LEFT,TOP,RIGHT,BOTTOM,COLOR)
以图形窗口(LEFT,TOP)为左上角,(RIGHT,BOTTOM)为右下角绘制矩形.
坐标单位是窗口沿水平和垂直方向的1/1000,取值范围是0—999,超出范围则可能显示在图形窗口外.
矩形中间填充颜色COLOR,COLOR为0表示不填充.
例如: DRAWRECTREL(0,0,500,500,RGB(255,255,0))表示在图形最左上部1/4位置用黄色绘制矩形.
```



**DRAWKLINE_IF**

```
使用条件画k线
用法:DRAWKLINE_IF=function(condition,high,open,low,close)
示例：DRAWKLINE_IF（C>O,H,O,L,C） 表示收盘价大于开盘价的时候，使用最高价、开盘价、最低价、收盘价画k线
```



**DRAWTEXT_FIX(COND,X,Y,TYPE,TEXT)**

```
固定位置显示文字;在指标排序中显示字符串栏目.
用法:DRAWTEXT_FIX(COND,X,Y,TYPE,TEXT),当COND条件满足时,在当前指标窗口内(X,Y)位置书写文字TEXT,X,Y为书写点在窗口中相对于左上角的百分比,TYPE:0为左对齐,1为右对齐
示例：DRAWTEXT_FIX(CURRBARSCOUNT=1 AND CLOSE/OPEN>1.08,0.5,0.5,0,‘大阳线’)表示最后一个交易日实体阳线大于8%时在窗口中间位置显示’大阳线’字样
```



**DRAWNUMBER_FIX**

```
固定位置显示数字
用法:DRAWNUMBER_FIX(COND,X,Y,TYPE,NUMBER),当COND条件满足时,在当前指标窗口内(X,Y)位置书写数字NUMBER,X,Y为书写点在窗口中相对于左上角的百分比,TYPE:0为左对齐,1为右对齐.
例如:DRAWNUMBER_FIX(CURRBARSCOUNT=1 AND CLOSE/OPEN>1.08,0.5,0.5,0,C)表示最后一个交易日实体阳线大于8%时在窗口中间位置显示收盘价.
```



**DRAWSL**

```
绘制斜线
用法:
DRAWSL(COND,PRICE,SLOPE,LEN,DIRECT),当COND条件满足时,在PRICE位置画斜线,SLOPE为斜率,LEN为长度,DIRECT为0向右延伸,1向左延伸,2双向延伸.
注意:
1.K线间的纵向高度差为SLOPE;
2.SLOPE为0时,为水平线;
3.SLOPE为10000时,为垂直线,LEN为向上的像素高度,DIRECT表示向上或向下延伸;
4.SLOPE和LEN支持变量;
```



**FILLRGN**

```
根据条件用RGN颜色填充区域
用法：FILLRGN(PRICE1,PRICE2,COND1,COLOR1,COND2,COLOR2…),
填充PRICE1到PRICE2之间的区域，当COND1条件满足时,用COLOR1颜色，当COND2条件满足时,用COLOR2颜色，否则不填充，从COLOR1之后的参数均可以省略，最多可以有15组条件。
例如：FILLRGN(CLOSE,OPEN,CLOSE>OPEN,RGB(255,0,0),CLOSE<OPEN,RGB(0,255,0))表示填充开盘价和收盘价之间的区域，阳线时用红色，阴线时用绿色，平盘不绘制。
```



**FLOATRGN**

```
用法:FLOATRGN(PRICE,WIDTH,COND1,COLOR1,COND2,COLOR2…)
以PRICE为基础填充宽度为WIDTH像素的区域,WIDTH为负则向下填充.
当COND1条件满足时,用COLOR1颜色,当COND2条件满足时,用COLOR2颜色,否则不填充,从COND1之后的参数均可以省略,最多可以有10组条件。
例如:FLOATRGN(CLOSE,VOL/HHV(VOL,10)*15,CLOSE>OPEN,RGB(255,0,0),1,RGB(0,255,0))表示沿收盘价填充宽度为成交量的区域,区域最大宽度为15像素,阳线时用红色,阴线时用绿色
```



**HORLINE**

```
在图形上绘制水平线
用法:
HORLINE(COND,PRICE,TYPE,EXTEND),当COND条件满足时,在PRICE位置沿水平方向绘制TYPE类型的线段,TYPE=0表示实线，1表示虚线’—‘，2表示点线’…‘，3表示点划线’-.-.-‘，4表示点点划线’-…-…-'。EXTEND=1 表示向左延长，=2表示向右延长，=3表示左右延长。
例如：HORLINE(HIGH>=HHV(HIGH,20),HIGH,1,2)表示在创20天新高时画水平虚线向右延伸。
```



**RGB**

```
将自定颜色作为数值输出
用法: RGB(Red,Green,Blue),输出为字符串RGB(Red,Green,Blue)
```



**RGBA**

```
将自定颜色作为数值输出
用法: RGBA(Red,Green,Blue,Alpha),输出为字符串 RGBA(Red,Green,Blue,Alpha) 。透明度（Alpha）取值 0~1 之间， 代表透明度
```



**PARTLINE**

```
用法:PARTLINE(PRICE,COND1,COLOR1,COND2,COLOR2…),
绘制PRICE线,当COND1条件满足时,用COLOR1颜色,当COND2条件满足时,用COLOR2颜色,否则不绘制,从COLOR1之后的参数均可以省略,最多可以有10组条件.
例如:PARTLINE(CLOSE,CLOSE>OPEN,RGB(255,0,0),CLOSE<OPEN,RGB(0,255,0),1,RGB(0,0,255))
表示画收盘价线,阳线时用红色,阴线时用绿色,平盘用蓝色.注意最后一个条件为1,表示前面都不满足时必然满足这个条件
```

```javascript
PARTLINE(CLOSE,CLOSE>OPEN,RGB(255,0,0),CLOSE<OPEN,RGB(0,255,0),1,RGB(0,0,255)),LINETHICK5;
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/fa12ab1c0ba44d84bfc2a05618e6aecd.png)

**PLOYLINE**

```
折线段
用法：PLOYLINE(COND,PRICE),当COND条件满足时,以PRICE位置为顶点画折线连接。
例如：PLOYLINE(HIGH>=HHV(HIGH,20),HIGH)表示在创20天新高点之间画折线。
```



**STICKLINE**

```
柱状图
用法: STICKLINE(COND,PRICE1,PRICE2,WIDTH,EMPTY),当COND条件满足时,在PRICE1和PRICE2位置之间画柱状线,宽度为WIDTH(10为标准间距),EMPTH为0画实心柱,-1画虚线空心柱,否则画实线空心柱。
例如：STICKLINE(CLOSE>OPEN,CLOSE,OPEN,0.8,1)表示画K线中阳线的空心柱体部分。
说明：WIDTH =50 或 3 宽度为K线宽度 WIDTH=101 宽度为K线宽度+间距宽度
STICKLINE(CLOSE>OPEN,CLOSE,0,50,1); 空心柱子
```



**VERTLINE**

```
在图形上绘制垂直线。
用法:
VERTLINE(COND,TYPE),当COND条件满足时,沿垂直方向绘制TYPE类型的线段,TYPE=0表示实线，1表示虚线’—‘，2表示点线’…‘，3表示点划线’-.-.-‘，4表示点点划线’-…-…-'。
例如：VERTLINE(HIGH>=HHV(HIGH,20),1)表示在创20天新高画垂直虚线。
```

```javascript
VERTLINE(HIGH>=HHV(HIGH,20),1)
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/7fd3dfd9b6b04580a6876456f7fa7a52.png)

**NULL**

```
返回空值。
例：
MA5:=MA(C,5);
MA10:=MA(C,10);
A:IFELSE(MA5>MA10,MA5,NULL),COLORRED;//当MA5>MA10时，画五日均线MA5，不满足MA5>MA10时，返回空值，不画线。
```



**TIPICON**

```
含义:在图形上显示图标，鼠标移近时显示文字。
用法:
TIPICON(COND,PRICE,TYPE, TEXT),当COND条件满足时,在PRICE位置显示图标(TYPE) 若PRICE=“TOP”, “BOTTOM” 顶部或底部输出图标， TEXT为tooltip提示信息文字内容，支持单值和序列字符串
例子：
```

```javascript
TIPICON(C>O, L, 1, STRFORMAT("低开高走<BR>收盘:{0}, 开盘:{1}", C,O )), COLORRED, YMOVE(5), FONTSIZE15,VALIGN0;
TIPICON(C>=H, H, 5, STRFORMAT("低开高走<BR>收盘:{0}, 最高:{1}", C,H )), COLORBROWN, YMOVE(-5), FONTSIZE15,VALIGN2;
```

效果图
![在这里插入图片描述](https://img-blog.csdnimg.cn/b44962f271da438888d3d7a308453996.png)

**DRAWGBK_DIV**

```
填充部分背景.
用法:
DRAWGBK_DIV(COND,COLOR1,COLOR2,填色方式,填充范围),填充满足COND条件的背景区域
填色方式:0是上下渐进 1是左右渐进 2是用COLOR1画框线 3是用COLOR1画框线,用COLOR2填充
填充范围:0为整个区域 1为最高最低区 2为开盘收盘区
例如:
DRAWGBK_DIV(C>O,RGB(221 ,160 ,221),RGB(255 ,215, 0),3,1);
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20122e50568140af9e576795b760ce32.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/4619c14106e545f087896816a2a3e100.png)

#### 财务数据函数

**FINANCE(1)**

```
总股本(万股)
返回该周期总股本
```



**FINANCE(7)**

```
流通股本(万股)
返回该周期流通股本
```



**FINANCE(9)**

```
资产负债率
返回该周期资产负债率
```



**FINANCE(18)**

```
每股公积金
返回每股公积金
```



**FINANCE(30)**

```
净利润
返回净利润
```



**FINANCE(32)**

```
每股未分配利润
返回每股未分配利润
```



**FINANCE(33)**

```
每股收益
每股收益(折算为全年收益),对于沪深品种有效
```



**FINANCE(34)**

```
每股净资产
返回每股净资产
```



**FINANCE(38)**

```
每股收益
返回每股收益(最近一期季报)
```



**FINANCE(40)**

```
流通市值
返回流通市值
```



**FINANCE(41)**

```
总市值
返回总市值
```



**FINANCE(42)**

```
上市的天数
返回上市的天数
```



**FINANCE(43)**

```
利润同比(Profit year on year)
返回利润同比
```



**FINANCE(45)**

```
股息率
返回股息率
```



**CAPITAL**

```
流通股本（手）
返回流通股本
```



**EXCHANGE**

```
换手率(成交量/流通股本)
返回换手率(成交量/流通股本)
```

#### 扩展

#### 即时行情函数

**DYNAINFO(3)**

```
昨收价
返回动态昨收价
```



**DYNAINFO(4)**

```
开盘价
返回动态开盘价
```



**DYNAINFO(5)**

```
最高价
返回动态最高价
```



**DYNAINFO(6)**

```
最低价
返回动态最低价
```



**DYNAINFO(7)**

```
最新价
返回动态最新价
```



**DYNAINFO(8)**

```
总量
返回动态成交总量
```



**DYNAINFO(10)**

```
成交额
返回动态成交额
```



**DYNAINFO(13)**

```
振幅
返回动态振幅
```



**DYNAINFO(14)**

```
涨幅
返回动态涨幅
```



**DYNAINFO(37)**

```
换手率
返回动态换手率
```



#### 扩展

其他DYNAINFO数据，可以通过回调外部提供。

#### 线形和资源函数

**CIRCLEDOT**

```
画小圆点
```



**COLORSTICK**

```
画上下柱子
```

```javascript
T:O-C,COLORSTICK;
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/e0e46de7fe014745bcb736a14f77ea5b.png)

**ICON**

```
在k线图上，显示小图标。
用法：ICON(TYPE,ICON);
当TYPE为1，则在K线最高价位置显示图标ICON，当TYPE为0，则在最低价位置显示图标ICON。
注：
1、该函数与判断条件连用，如：COND,ICON(TYPE,ICON);
2、该函数支持在函数后设置垂直对齐方式：VALIGN0（上对齐）、VALIGN1（中对齐）、VALIGN2（下对齐）即可以写为如下格式：
CLOSE<OPEN,ICON(1,‘阴’),VALIGN0;
例1：
CLOSE>OPEN,ICON(1,‘ICO1’);
//表示K线收盘大于开盘时，在最高价上显示图标1。写完“ICON(1,” 以后，点击插入图标按钮，再单击选中的图标插入到函数中，图标用 ‘ICO1’~'ICO105’表示
```



**XMOVE**

```
绘图时让图形向X轴偏移N个像素, 可以和DRAWTEXT, DRAWICON连用
用法:
XMOVE(offset) offset偏移的像素
如:
DRAWTEXT(CLOSE<OPEN,H,14),VALIGN2,ALIGN1,YMOVE(-10), XMOVE(5);
```



**YMOVE**

```
绘图时让图形向Y轴偏移N个像素，可以和DRAWTEXT, DRAWICON连用
用法:
YMOVE(offset) offset偏移的像素
如:
DRAWICON(CLOSE<OPEN,H,14),VALIGN2,ALIGN1,YMOVE(-10), XMOVE(5);
```



**UPCOLOR**

```
正的颜色

可以跟VOLSTICK,COLORSTICK 连用

如：
VOL:VOL,VOLSTICK,UPCOLOR(RGB(139, 101, 8)),DOWNCOLOR(RGBA(0,255,0,0.5));
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/771890729ddc4b5f9f6f6ed2dbe10c84.png)

**DOWNCOLOR**

```
负的颜色

可以跟VOLSTICK,COLORSTICK 连用
如：
VOL:VOL,VOLSTICK,UPCOLOR(RGB(30, 144, 255)),DOWNCOLOR(RGB(255, 110, 180));
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/b8a4c59cd2884f299cf992a40798f4b9.png)

**LINEAREA**

```
绘制线段和底部边框围成的面积图

示例1
```

```javascript
VOL:VOL,LINEAREA, RGB(255,100,100);
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/ee4ff5e4d9954f05940ea7f948721725.png)

```
示例2
```

```javascript
VOL:VOL,LINEAREA, DOWNCOLOR(RGBA(255,0,0,0.3)), RGB(255,100,100);
  //DOWNCOLOR() 底部面积颜色
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/c281be869dac4097b249a7fd6d37fd75.png)

**LINETHICK**

```
LINETHICK1
线形粗细1
LINETHICK2 线形粗细2
线形粗细2
LINETHICK3 线形粗细3
线形粗细3
LINETHICK4 线形粗细4
线形粗细4
LINETHICK5 线形粗细5
线形粗细5
LINETHICK6 线形粗细6
线形粗细6
LINETHICK7 线形粗细7
线形粗细7
LINETHICK8 线形粗细8
线形粗细8
LINETHICK9 线形粗细9
线形粗细9
LINETHICK10 线形粗细10
线形粗细10
LINESTICK 同时画出柱状线和指标线
同时画出柱状线和指标线
```



**STICK**

```
画柱状图
```



**VOLSTICK**

```
成交量柱状线。当股价上涨时显示红色空心柱，反之则显示绿色实心柱
```

```
示例1
```

```javascript
T:O-C,VOLSTICK;
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/ac619380b2904ee39b177508b656f7c2.png)

```
示例2
```

```javascript
T:VOL, VOLSTICK;
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/5c6590ad97464a6980e6f581532a3d9d.png)

**FONTSIZE**

```
设置字体大小。
用法：
FONTSIZEX，X为8至72，表示字体由小到大。
注：
1、不支持将该函数直接定义为变量，即不支持下面的写法：A:FONTSIZE9;
2、该函数只支持和DRAWTEXT或DRAWNUMBER函数连用。
例1：
DRAWTEXT(C>O,H,‘阳线’),FONTSIZE10;//如果收盘价大于开盘价，则在K线最高价处以10的字体大小标注阳线。
例2：
DRAWTEXT(C<O,L,‘阴线’),ALIGN0,VALIGN2,FONTSIZE30;//如果收盘价小于开盘价，则在K线最低价处以30的字体大小，居左居上标注阴线。
例3：
DRAWNUMBER(DATE<>REF(DATE,1),L,REF(C,1),2,COLORRED),FONTSIZE10;//表示在当天第一根k线的最低价处以红色显示昨收盘价数值(精确2为小数)，数值字体大小为10。
```



**VALIGN0,VALIGN1,VALIGN2**

```
设置文字垂直对齐方式（上中下）。
用法：DRAWTEXT(COND,PRICE,TEXT),VALIGNX;
COND条件满足时，在PRICE的位置，标注TEXT，文字按照VALIGNX写入的方式对齐。VALIGN0，VALIGN1，VALIGN2，分别表示上对齐，居中对齐，下对齐。
注：该函数只支持和DRAWTEXT或DRAWNUMBER函数连用。
例1：
DRAWTEXT(C>O,H,‘涨’),ALIGN1,VALIGN1,FONTSIZE20,COLORGREEN;//在阳线的最高价标注文字“涨”，文字居中对齐，字体大小为20，颜色为绿色。
例2：
DRAWNUMBER(C>O,H,H,2,COLORBLUE),ALIGN0,VALIGN0;//在阳线的最高价位置标出最高价，保留两位小数。文字显示问蓝色，居左居上对齐。
```



**ALIGN0,ALIGN1,ALIGN2**

```
设置文字水平对齐方式（左中右）
用法：DRAWTEXT(COND,PRICE,TEXT),ALIGNX;
COND条件满足时，在PRICE的位置，标注TEXT，文字按照ALIGNX写入的方式对齐。ALIGN0，ALIGN1，ALIGN2，分别表示左对齐，居中对齐，右对齐。
注：该函数只支持和DRAWTEXT或DRAWNUMBER函数连用。
例1：
DRAWTEXT(C>O,H,‘涨’),ALIGN1,VALIGN1,FONTSIZE20,COLORGREEN;//在阳线的最高价标注文字“涨”，文字居中对齐，字体大小为20，颜色为绿色。
例2：
DRAWNUMBER(C>O,H,H,2,COLORBLUE),ALIGN0,VALIGN0;//在阳线的最高价位置标出最高价，保留两位小数。文字显示问蓝色，居左居上对齐。
```



**NODRAW**

```
不画该线 指标的标题栏会显示改数据
```



**NOTEXT | NOTITLE**

```
输出线名称前带有NOTEXT字样时,不显示输出线数据
```



```
COLORYELLOW 画黄色

画黄色

COLORBLACK 画黑色

画黑色

COLORBLUE 画蓝色

画蓝色

COLORGREEN 画绿色

画绿色

COLORCYAN 画青色

画青色

COLORRED 画红色

画红色

COLORMAGENTA 画洋红色

画洋红色

COLORBROWN 画棕色

画棕色

COLORLIGRAY 画淡灰色

画淡灰色

COLORGRAY 画深灰色

画深灰色

COLORLIBLUE 画淡蓝色

画淡蓝色

COLORLIGREEN 画淡绿色

画淡绿色

COLORLICYAN 画淡青色

画淡青色

COLORLIRED 画淡红色

画淡红色

COLORLIMAGENTA 画淡洋红色

画淡洋红色

COLORWHITE 画白色

画白色

COLOR 自定义色

格式为COLOR+“BBGGRR”：BB、GG、RR表示蓝色、绿色和红色的分量，每种颜色的取值范围是00-FF，采用了16进制。
例如：MA5:MA(CLOSE,5)，COLOR00FFFF表示纯红色与纯绿色的混合色：COLOR808000表示淡蓝色和淡绿色的混合色。

RGBX

格式为RGBX+“RRGGBB”：RR、GG、BB表示红色、绿色和的蓝色分量，每种颜色的取值范围是00-FF，采用了16进制。
例如：MA5:MA(CLOSE,5)，RGBXFFFF00表示纯红色与纯绿色的混合色：RGBX008080表示淡蓝色和淡绿色的混合色。
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/6a6f7bed1fe946e5a78cc7ca83425554.png)

#### 系统函数

**SYSPARAM(2)**

```
系统参数:主图可见K线最初位置.
注意：该函数仅K线图形分析时有效。
```



**SYSPARAM(3)**

```
系统参数:主图可见K线最后位置.
注意：该函数仅K线图形分析时有效。
```



**SYSPARAM(4)**

```
系统参数:主图可见K线最高价.
注意：该函数仅K线图形分析时有效。
```



**SYSPARAM(5)**

```
系统参数:主图可见K线最低价.
注意：该函数仅K线图形分析时有效。
```

```javascript
DRAWTEXTREL(0,20,STRFORMAT("当前屏K线最小值: {0}",SYSPARAM(5))), RGB(250,0,0);
DRAWTEXTREL(0,60,STRFORMAT("当前屏K线最大值: {0}",SYSPARAM(4))), RGB(0,250,0);

DRAWTEXTREL(0,100,STRFORMAT("主图可见K线最初位置: {0}",SYSPARAM(2))), RGB(0,0,0);
DRAWTEXTREL(0,140,STRFORMAT("主图可见K线最后位置: {0}",SYSPARAM(3))), RGB(0,0,0);
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/b026fcb99d234ddf885ac79b04249a50.png)

**指标调用**

```
CALCSTOCKINDEX(品种代码,指标名称,指标线)
```

```
指标引用。
用法:
CALCSTOCKINDEX(品种代码,指标名称,指标线),返回该指标相应输出的计算值。
例如:
CALCSTOCKINDEX(‘SH600000’,‘KDJ’,3)表示上证600000的KDJ指标第3个输出即J之值,第一个参数可在前面加SZ(深市),SH(沪市),BJ(京市),或市场_,
CALCSTOCKINDEX(‘47_IFL0’,‘MACD’,2)表示IFL0品种的MACD指标第2个输出值。
注意:引用品种的对应周期的数据必须要先下载到本地
```



**STKINDI**

```
用法:STKINDI(‘STKNAME’,‘INDINAME’,PARAMs)，STKNAME是股票代码，INDINAME是指标及其指标线名称,PARAM是可选参数，其数量应当等于被应用指标的参数数量，否则将使用缺省参数数值。
例如:STKINDI(‘SZ300059’,‘MA.MA1’,5,10,15,20)表示引用东方财富的MA指标的MA1指标线，计算参数5，10，15，20；STKINDI(‘sz300059’,‘KDJ.K#WEEK’,9,4,4,)表示引用东方财富的周线KDJ指标的K指标线，计算参数9,4,4。
```



#### 操作符

**$**

```
例如:"000014 C L O S E " , 表示取 000014 的收盘价 , 注意加入双引号 . 可在前面加 S Z ( 深市 ) , S H ( 沪市 ) , B J ( 京市 ) , 或市 场 , , " S Z 000001 CLOSE",表示取000014的收盘价,注意加入双引号. 可在前面加SZ(深市),SH(沪市),BJ(京市),或市场_,,"SZ000001 CLOSE",表示取000014的收盘价,注意加入双引号.可在前面加SZ(深市),SH(沪市),BJ(京市),或市场,,"SZ000001CLOSE"表示平安银行
格式： 股票代码$数据名称
数据名称 支持：‘CLOSE’,‘C’,‘VOL’,‘V’,‘OPEN’,‘O’,‘HIGH’,‘H’,‘LOW’,‘L’,‘AMOUNT’,‘AMO’,‘VOLINSTK’
```

```javascript
收盘价:"000001$CLOSE",NODRAW;
  开盘价:"000001$OPEN",NODRAW;
  最高价:"000001$HIGH",NODRAW;
  最低价:"000001$LOW",NODRAW;
  DRAWKLINE(最高价,开盘价,最低价,收盘价);
  12345
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/dc0b87f95a824cfaa1a4eedb46fe0fe2.png)

**‘#’**

```
跨周期引用符号。
\#后可用MIN1,MIN5,MIN15,MIN30,MIN60,MIN120,MIN240,DAY,WEEK,MONTH,SEASON,YEAR … （具体见周期名称列表）
例如:TMP1:=CLOSE#WEEK;
只可用于OPEN,HIGH,LOW,CLOSE,VOL,AMOUNT,VOLINSTK,当前周期不支持多秒线,多分钟线和多日线,并且引用周期必须要高于当前周期

TMP2:=KDJ.K#WEEK;
跨周期指标引用
跨周期指标引用不支持带参数
提示:跨周期时,可能会引用到未来数据
```



#### 周期名称列表

```
MIN1 = 1分钟
MIN5 = 5分钟
MIN15 = 15分钟
MIN30 = 30分钟
MIN60 = 1小时
MIN120 = 2小时
MIN240 = 4小时
DAY = 日
WEEK = 周
MONTH =月
SEASON = 季
YEAR =年
```



### JavaScript文档

### Python文档

## 模型编写

### JavaScript文档

### Python文档

# 魔方学院

## 会员中心

## 期魔方会员权益对比

|      |                                                              | 普通会员 | 黄金会员      | 超级会员      | Plus会员       |
| ---- | ------------------------------------------------------------ | -------- | ------------- | ------------- | -------------- |
| 1    | [模拟账户](https://academy.qmfquant.com/?golink=aHR0cHM6Ly93d3cuc2ltbm93LmNvbS5jbi8=) | ✔        | ✔             | ✔             | ✔              |
| 2    | 实盘账户                                                     | ✘        | 1             | 5             | 10             |
| 3    | 期货公司                                                     | ✘        | 无限制        | 无限制        | 无限制         |
| 4    | [积分](https://academy.qmfquant.com/7932.html)               | 推广计划 | 推广计划      | 推广计划      | 双倍积分       |
| 5    | 专业图表                                                     | ✘        | ✘             | ✔             | ✔              |
| 6    | [免费指标](https://academy.qmfquant.com/category/clzl)       | ✔        | ✔             | ✔             | ✔              |
| 7    | [积分指标](https://academy.qmfquant.com/category/clzl)       | 积分兑换 | 7折积分       | 3折积分       | 无限下载       |
| 8    | [付费指标](https://academy.qmfquant.com/category/clzl)       | 现金购买 | 7折优惠       | 3折优惠       | 无限下载       |
| 9    | [免费策略](https://academy.qmfquant.com/category/clzl)       | ✔        | ✔             | ✔             | ✔              |
| 10   | [积分策略](https://academy.qmfquant.com/category/clzl)       | 积分兑换 | 7折积分       | 3折积分       | 无限下载       |
| 11   | [付费策略](https://academy.qmfquant.com/category/clzl)       | 现金购买 | 7折优惠       | 3折优惠       | 无限下载       |
| 12   | 弹窗预警（调试中）                                           | ✔        | ✔             | ✔             | 1对1指导       |
| 13   | 微信预警（测试中）                                           | ✘        | ✘             | ✔             | 1对1指导       |
| 14   | 量化平台（内测中）                                           | ✔        | ✔             | ✔             | 1对1指导       |
| 15   | 回测系统（内测中）                                           | ✘        | ✔             | ✔             | 1对1指导       |
| 16   | [AI分析](https://academy.qmfquant.com/7823.html)             | ✔        | ✔             | ✔             | ✔              |
| 17   | [基差分析](https://academy.qmfquant.com/7853.html)           | ✘        | ✔             | ✔             | ✔              |
| 18   | MT4CTP                                                       | ✘        | ✔             | ✔             | ✔              |
| 19   | [盘手训练](https://academy.qmfquant.com/7818.html)           | ✔        | ✔             | ✔             | ✔              |
| 20   | [策略编写服务](https://academy.qmfquant.com/forum-post/7994.html) | ✘        | ✘             | 5次           | 无限次数       |
| 21   | [Python学习](https://academy.qmfquant.com/7407.html)         | ✘        | ✘             | 精彩教学视频  | 0基础1对1      |
| 22   | 远程协助                                                     | ✘        | ✘             | ✘             | 7*12h响应      |
| 23   | VIP专属群                                                    | ✘        | ✔             | ✔             | ✔              |
|      | 费用                                                         | **免费** | **1499元/年** | **9800元/年** | **19800元/年** |

**权益说明：**

1. 任何会员都可以使用上期模拟账户测试，无账号使用限制，上期模拟注册地址：[https://www.simnow.com.cn/](https://academy.qmfquant.com/?golink=aHR0cHM6Ly93d3cuc2ltbm93LmNvbS5jbi8=)（上期模拟官网只有在日间开盘时间可以打开）
2. 对实盘账户的期货公司，不做限制，支持CTP接口的期货公司均可自由选择
3. 可通过登录签到，分享好友注册，现金购买等方式，获得积分，积分可兑换部分商品或服务
4. 可通过登录签到，分享好友注册，现金购买等方式，获得积分，积分可兑换部分产品
5. 专业图表包含:订单流、renko砖形图、聚客系统、量仓动能、金手指系统等
6. 魔方商学院的免费指标任何会员都可以使用
7. 魔方商学院提示需要积分兑换的指标，注册会员需足额兑换，黄金会员折扣兑换，超级会员免费下载
8. 魔方商学院提示需要付费购买的指标，注册会员需足额购买，黄金会员折扣优惠购买，超级会员免费下载
9. 魔方商学院的免费策略任何会员都可以使用
10. 魔方商学院提示需要积分兑换的策略，注册会员需足额兑换，黄金会员折扣兑换，超级会员免费下载
11. 魔方商学院提示需要付费购买的策略，注册会员需足额购买，黄金会员折扣优惠购买，超级会员免费下载
12. 用户自己设置的指标信号，策略信号，账户监控等，能时时以弹窗形式推送出来
13. 用户自己设置的指标信号，策略信号等，能时时推送到用户的手机微信
14. 用户可以在期魔方平台自由编写策略
15. 用户可以在期魔方平台无限制进行策略回测
16. 多维度AI智能分析决策引擎，好用的市场分析工具
17. 期货与现货数据对比分析，解析当下套期保值空间
18. 通过MT4直连期魔方量化平台，实现MT4交易国内期货账户
19. 通过历史盘面训练，快速验证自己策略可行性，也适用于熟悉市场交易规则
20. 期魔方官方技术老师为用户提供策略指标定制编写服务，仅限于在期魔方软件的策略开发
21. 期魔方官方为用户提供0基础Python量化课程培训学习，直播+回放+陪伴成长
22. 如果您在软件使用过程中有任何问题，期魔方提供一对一远程协助服务
23. VIP专属服务群，有问题随时获得技术老师解答和远程协助

## 推广奖励

### **前言**

您觉得期魔方软件好用吗？里面的功能以及客服人员对您的交易有帮助吗？如果有，您可以将【期 魔 方 软 件】分享给身边朋友使用，让大家一起成就更专业的自己吧！更重要的是，您将获得10%的推荐奖励，可直接提现哦，快来试一试吧！

### **操作指引**

分享链接—新用户打开链接注册登录—购买需要的商品—立即购买—确认是否享受折扣价—确认无误后立即支付—分享人收到系统通知收到返佣—立即提现—提交提现申请—设置收款码—等待2-3小时系统审核无误后提现到账。

### **具体流程**

1. 分享链接

方式1：打开任意付费资源的分享链接

![图片[1]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd195212-1024x759.png)



方式2：点击右上角用户头像，点击用户中心，进入界面后，点击推广中心，复制推广链接，此链接为您的专属推广链接

![图片[2]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd202339.png)

![图片[3]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd202702.png)

![图片[4]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd202918.png)



2. 新用户打开推广链接注册登录

![图片[5]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd200017-1024x928.png)注意：您的推广链接格式为 `?ref=xxx`也就是说本站任意链接结尾加上?ref=xxx 均属于您的推广链接

3.购买需要的商品——立即购买——确认是否享受推广折扣——确认无误后立即支付

![图片[6]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd200201-1024x855.png)



4.分享人收到系统通知收到返佣

![图片[7]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/7e3ed19f07200314-1024x225.png)

5.立即提现——提交提现申请——设置收款

![图片[8]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd200447-1024x577.png)

![图片[9]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/a899de71c0200527-1024x624.png)

![图片[10]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd200547-1024x703.png)

6.提现成功

![图片[11]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd202146.png)

![图片[12]-期魔方推广计划，人人都可返佣](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2b5ca33bd202216.png)



7. **提醒事项**

- 当您登录后使用本站任意内容的分享功能，分享的链接都是您的推广链接**（仅对vip会员开放，普通会员不享受该权限）**
- 其它用户使用您的推广链接打开本站之后就会储存推荐人，之后在本站任意链接购买的任意商品都会返佣
- 如果其它用户使用您的推广链接打开本站之后完成注册，那么此用户今后的所有消费都会返佣
- 当佣金积累到100元之后就可以申请提现啦！申请提现之前请在用户中心-打赏收款处设置好你的收款码哦

## 学习中心

### 盘手训练营

### Python编程学习

如果你对数字、模型和量化充满激情，如果你想在量化领域有所发展，可以试试魔方学院Python量化零基础入门+进阶实战营，在这里我们不讲虚的，只讲实的，我们一起深度学习python量化，深入研究策略和量化技术，更多精彩课程，尽在魔方学院

[量化培训-魔方商学院 (qmfquant.com)](https://academy.qmfquant.com/archives/category/lhpx)

课程特色

1.门槛低：0基础起步，新手也可以入门

2.更精准：学习目标精准，面相量化交易学习

3.应用广：涵盖大数据，机器学习，深入浅出全球最顶流的量化研究

4.专业高：名师授课，教材规范，切合交易实战

# 常见问题

## 期魔方软件下载

期魔方平台下载注册登录

### **软件下载**

下载地址：https://www.qmfquant.com/#/product

期魔方量化投研平台使用最新代IT信息技术，仅支持电脑运行，但win7含以下PC版本，均无法安装使用，安装前，请确认您的电脑配置

![图片[1]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/ac5fb35248205900.png)

### **软件安装**

软件下载后，可能会被360或其他杀毒软件拦截，这时点信任即可，我们以Edeg浏览器作为案例

![图片[2]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/2a8c7110f3210144.png)

如果出现以上提示，请点开它，选择仍然保留

![图片[3]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/dc9d7684ce210219.png)

软年下载成功后，双击，运行，如下图显示

![图片[4]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/babacd91ad210257.png)

客户端默认安装在C盘，您可以手动选择安装到其他磁盘

![图片[5]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/cd526a149d210349.png)

连续点下一步，安装后，出现安装进度

![图片[6]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/2cb1c7863e210459.png)

初次安装时需要解压和配置的文件较多，请耐心等待安装成功

### **账户注册和登录**

安装完成后，PC端会自动弹出登录窗口，如下图

![图片[7]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/e071435110210533.png)

如果没有弹出登录窗口，请在电脑桌面找到期魔方客户端快捷方式，打开它

初次登录，没有期魔方账号，则点击登录对话框下方的注册按钮，弹出注册界面，如下图

![图片[8]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/c3c76b4c9d210633-1024x583.png)

用户名是一定要设置的，将是您接下来要登录期魔方客户端的重要依据

输入正确手机号后，会弹出人机验证窗口，验证成功后，您手机会收到一条由期魔方官方发送的验证码

![图片[9]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/a50c496547210658.png)

![图片[10]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/07c94102b9210719.png)

设置的密码，您一定要记住，很有用户新注册就忘记了密码

邀请码是可以不用填写的，忽略即可

![图片[11]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/fc936fecf0210801.png)

提交注册后，魔方学院显示账户信息，则表示登录成功

![图片[12]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/0ee2f56dda210841-1024x583.png)

好了，到这里为止，账号就注册成功了，这时，在客户端登录窗口，登录您的账户和密码，注意不是手机号

![图片[13]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/cc8e9b7ca8210903.png)

选中登录后，客户端开始启动并配置数据参数，第一次登录可能会花费数十秒时间，这取决于您的电脑配置和网络速度

![图片[14]-期魔方平台下载注册登录，保姆级教程-魔方商学院](https://academy.qmfquant.com/wp-content/uploads/2023/08/d2f11ce876210936.png)

加载结束后，看到K线图表，则登录成功

## 策略安全性

在期魔方量化投研平台上开发策略，策略仅用户本人在本地终端可见

期魔方量化投研平台属于本地化部署，单机运行，只有会员等级需要和期魔方后端服务器校验，不存在获取用户策略模型信息可能

## 实盘账户安全性

期魔方对接期货柜台为CTP直连模式，受证监会看穿式监管，期魔方无法获取期货实盘持仓和资金等信息

## 24小时自动登录维护设置

如果您是做量化全自动交易，需要设置期货账户的自动登录维护，在开盘前，期魔方可按用户授权，自动登录期货实盘账户并确认结算单

操作方法：持仓面板-设置-是否自动登录（打开）-保存设置

![image-20231023202104893](../../docs/static/typora-user-images/image-20231023202104893.png)

## 云服务器的重要性

简单几步，教你在服务器上实现量化交易全自动无人值守模式
很多同学在学习量化时会有疑虑，我在自己电脑运行量化交易就可以了，为什么要挂在云服务器呢？

### 选购服务器（云主机）

为什么要先选购云主机？

1.程序化交易可能需要7*24小时不间断运行，

2.量化交易要求网络恒定不断线，

3.再比如说我们期魔方团队在成都，但是期货公司机房在上海，从成都到达上海的网络距离较远，会产生不小的网络延迟

这些在本地家用电脑实现的门槛较高；

所以最终实现量化交易还是需要一个符合要求的云主机。

打开云商店（可以按自己的需求选用），主流的云服务器厂商，如腾讯云，阿里云，百度云，华为云，亚马逊，天翼云等
注册云商店账户并完成个人实名认证，根据需求选择产品

地区：上海（其他地区根据自己需求购买，一般主流期货服务器在上海居多）
配置：2核4G 40G RSSD云盘（可以按自己的需求选用）
带宽： 5M（可以按自己的需求选用）
镜像：window2012 64位（可以按自己的需求选用）
购买云主机，在云厂商控制台获得云主机IP地址、登录用户名、设置登录密码

### 远程连接云主机

获得云服务器后，可以用windows 自带的远程连接程序连接云主机

按下快捷键 Win + R 打开运行，输入mstsc 回车

输入云服务器IP,用户名和密码，登入

一般用户名为administrator,密码自设定，IP为公网IP，在控制台可查看

![image-20231024095350347](../../docs/static/typora-user-images/image-20231024095350347.png)

![image-20231024095440317](../../docs/static/typora-user-images/image-20231024095440317.png)

![image-20231024095509680](../../docs/static/typora-user-images/image-20231024095509680.png)





手机APP或平板电脑链接云服务器同理

手机下载远程连接APP: RD Client，下载后打开RD Client
添加电脑名称：输入云服务器IP地址
添加用户账户：输入登录用户名和已设置的密码
连接云服务器

### 在云服务器安装期魔方

方式1、将本地下载好的期魔方安装包复制进云服务器，安装运行即可

方式2、在云服务器登录期魔方官方网站，进行下载安装





